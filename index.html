<script>
  const formURL = "https://docs.google.com/forms/d/e/1FAIpQLSf-vR_Z4v8x6y6wIYg-Ki9_LKC3rrWydxglt8uxAkTdAWbJ6A/formResponse";
  const entries = {
    name: "entry.147771650",
    index: "entry.1154045172",
    subject: "entry.831143142",
    result: "entry.459883525"
  };

  function addSubject() {
    const container = document.getElementById("subjectContainer");
    const row = document.createElement("div");
    row.className = "subject-row";
    row.innerHTML = `
      <select required>
        <option value="">Select Subject</option>
        <option>Science(Sinhala Medium)</option>
        <option>Mathematics(Sinhala Medium)</option>
        <option>English</option>
        <option>Sinhala</option>
        <option>History</option>
        <option>Commerce</option>
        <option>Japan</option>
        <option>ICT</option>
        <option>Science(English Medium)</option>
        <option>Mathematics(English Medium)</option>
      </select>
      <select required>
        <option value="">Select Result</option>
        <option>A</option>
        <option>B</option>
        <option>C</option>
        <option>S</option>
        <option>W</option>
      </select>`;
    container.appendChild(row);
  }

  document.getElementById("mainForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const studentName = this.studentName.value;
    const indexNumber = this.indexNumber.value;

    const rows = document.querySelectorAll(".subject-row");

    rows.forEach(row => {
      const selects = row.querySelectorAll("select");
      const subject = selects[0].value;
      const result = selects[1].value;

      if (subject && result) {
        const formData = new FormData();
        formData.append(entries.name, studentName);
        formData.append(entries.index, indexNumber);
        formData.append(entries.subject, subject);
        formData.append(entries.result, result);

        fetch(formURL, {
          method: "POST",
          mode: "no-cors",
          body: formData
        });
      }
    });

    alert("All subjects submitted!");
    this.reset();

    // Reset to one default subject-result pair
    document.getElementById("subjectContainer").innerHTML = `
      <div class="subject-row">
        <select required>
          <option value="">Select Subject</option>
          <option>Science(Sinhala Medium)</option>
          <option>Mathematics(Sinhala Medium)</option>
          <option>English</option>
          <option>Sinhala</option>
          <option>History</option>
          <option>Commerce</option>
          <option>Japan</option>
          <option>ICT</option>
          <option>Science(English Medium)</option>
          <option>Mathematics(English Medium)</option>
        </select>
        <select required>
          <option value="">Select Result</option>
          <option>A</option>
          <option>B</option>
          <option>C</option>
          <option>S</option>
          <option>W</option>
        </select>
      </div>`;
  });
</script>
